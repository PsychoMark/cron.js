!function(t){"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?t(require("moment-timezone"),exports):"function"==typeof define&&define.amd?define(["moment-timezone","exports"],t):t(moment)}(function(t,e){function n(e,n){this.source=e,this.zone=n;var i=this;if(s.map(function(t){i[t]={}}),this.source instanceof Date)this.source=t(this.source),this.realDate=!0;else if(this._parse(),!this._verifyParse())throw Error("Could not verify a valid date. Please verify your parameters.")}function i(t,e,i,s,h,u,c){var f=t;return"string"!=typeof t&&1==arguments.length&&(e=t.onTick,i=t.onComplete,u=t.context,s=t.start||t.startNow||t.startJob,h=t.timeZone,c=t.runOnInit,f=t.cronTime),this.context=u||this,this._callbacks=[],this.onComplete=i,this.cronTime=new n(f,h),o.call(this,e),c&&r.call(this),s&&a.call(this),this}var s=["second","minute","hour","dayOfMonth","month","dayOfWeek"];n.constraints=[[0,59],[0,59],[0,23],[1,31],[0,11],[0,6]],n.monthConstraints=[31,29,31,30,31,30,31,31,30,31,30,31],n.parseDefaults=["0","*","*","*","*","*"],n.aliases={jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11,sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6},n.prototype={_verifyParse:function(){for(var t=Object.keys(this.month),e=0;e<t.length;e++){for(var i=t[e],s=n.monthConstraints[parseInt(i,10)],o=!1,r=Object.keys(this.dayOfMonth),a=0;a<r.length;a++){var h=r[a];s>=h&&(o=!0)}if(!o)return console.error("Month '"+i+"' is limited to '"+s+"' days."),!1}return!0},sendAt:function(){var e=this.realDate?this.source:t();if(this.zone&&(e=e.tz(this.zone)),this.realDate)return e;var n=new Date,i=e.seconds(),s=Math.abs(i-n.getSeconds());return(0==s||1==s&&n.getMilliseconds()<=e.milliseconds())&&(e=e.add(1,"s")),e=this._getNextDateFrom(e)},getTimeout:function(){return Math.max(-1,this.sendAt()-t())},toString:function(){return this.toJSON().join(" ")},toJSON:function(){var t=this;return s.map(function(e){return t._wcOrAll(e)})},_getNextDateFrom:function(e){var n=t(e);if("Invalid date"==n.toString())return console.log("ERROR: You specified an invalid date."),n;if(this.realDate&&e<new Date&&console.log("WARNING: Date in past. Will never be fired."),this.realDate)return n;for(;;){var i=n-e,s=new Date(n);if(n.month()in this.month)if(n.date()in this.dayOfMonth)if(n.day()in this.dayOfWeek)if(n.hours()in this.hour)if(n.minutes()in this.minute){if(n.seconds()in this.second)break;s=t(n),n.seconds(59==n.seconds()&&i>6e4?0:n.seconds()+1),s>=n&&(n=this._findDST(s))}else s=t(n),n.minutes(59==n.minutes()&&i>36e5?0:n.minutes()+1),n.seconds(0),s>=n&&(n=this._findDST(s));else s=t(n),n.hours(23==n.hours()&&i>864e5?0:n.hours()+1),n.minutes(0),n.seconds(0),s>=n&&(n=this._findDST(s));else n.add(1,"d"),n.hours(0),n.minutes(0),n.seconds(0),s>=n&&(n=this._findDST(s));else n.add(1,"d"),n.hours(0),n.minutes(0),n.seconds(0);else n.add(1,"M"),n.date(1),n.hours(0),n.minutes(0),n.seconds(0)}return n},_findDST:function(e){for(var n=t(e);e>=n;)n.add(1,"s");return n},_wcOrAll:function(t){if(this._hasAll(t))return"*";var e=[];for(var n in this[t])e.push(n);return e.join(",")},_hasAll:function(t){for(var e=n.constraints[s.indexOf(t)],i=e[0],o=e[1];o>i;i++)if(!(i in this[t]))return!1;return!0},_parse:function(){for(var t,e=n.aliases,i=(this.source.replace(/[a-z]{1,3}/gi,function(t){if(t=t.toLowerCase(),t in e)return e[t];throw new Error("Unknown alias: "+t)})),o=i.replace(/^\s\s*|\s\s*$/g,"").split(/\s+/),r=0,a=s.length;r<s.length;r++)t=o[r-(a-o.length)]||n.parseDefaults[r],this._parseField(t,s[r],n.constraints[r])},_parseField:function(t,e,n){var i,s=/^(\d+)(?:-(\d+))?(?:\/(\d+))?$/g,o=this[e],r=n[0],a=n[1];t=t.replace(/\*/g,r+"-"+a);for(var h=t.split(","),u=0;u<h.length;u++){if(!h[u].match(s))throw new Error("Field ("+t+") cannot be parsed");h[u].replace(s,function(t,e,n,s){s=parseInt(s)||1,e=Math.min(Math.max(r,~~Math.abs(e)),a),n=n?Math.min(a,~~Math.abs(n)):e,i=e;do o[i]=!0,i+=s;while(n>=i)})}}};var o=function(t){"function"==typeof t&&this._callbacks.push(t)};i.prototype.addCallback=o,i.prototype.setTime=function(t){if(!(t instanceof n))throw new Error("'time' must be an instance of CronTime.");this.stop(),this.cronTime=t},i.prototype.nextDate=function(){return this.cronTime.sendAt()};var r=function(){for(var t=this._callbacks.length-1;t>=0;t--)this._callbacks[t].call(this.context,this.onComplete)};i.prototype.fireOnTick=r;var a=function(){function t(){s?(s>e?(s-=e,i=e):(i=s,s=0),n._timeout=setTimeout(t,i)):(n.running=!1,n.runOnce||n.start(),n.fireOnTick())}if(!this.running){var e=2147483647,n=this,i=this.cronTime.getTimeout(),s=0;this.cronTime.realDate&&(this.runOnce=!0),i>=0?(this.running=!0,i>e&&(s=i-e,i=e),this._timeout=setTimeout(t,i)):this.stop()}};i.prototype.start=a,i.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this.running=!1,"function"==typeof this.onComplete&&this.onComplete()},e&&(e.CronJob=i,e.CronTime=n)});